<!-- simple front end to show javascript query result in console -->

<html>
    <head>
        <script>

class SPARQLQueryDispatcher {
	constructor( endpoint ) {
		this.endpoint = endpoint;
	}

	query( sparqlQuery ) {
		const fullUrl = this.endpoint + '?query=' + encodeURIComponent( sparqlQuery );
		const headers = { 'Accept': 'application/sparql-results+json' };

		return fetch( fullUrl, { headers } ).then( body => body.json() );
	}
}

const endpointUrl = 'https://query.wikidata.org/sparql';
const sparqlQuery = `SELECT ?drug ?drugLabel 
(GROUP_CONCAT(DISTINCT ?physicalInteractionLabelGroup;separator=", ") as ?PhysicalInteractionLabel)
(GROUP_CONCAT(DISTINCT ?molecularStructurePic;separator=", ") as ?molecularStructure)
(GROUP_CONCAT(DISTINCT ?otherConditionsTreatedLabel;separator=", ") as ?otherCondtionsTreated)
(GROUP_CONCAT(DISTINCT ?ChemblKeyLabel;separator=", ")      as ?ChembleID)
(GROUP_CONCAT(DISTINCT ?ActiveInLabel;separator=", ")       as ?ActiveInLabelGroup)
(GROUP_CONCAT(DISTINCT ?cancerTreatedLabel;separator=", ")  as ?cancerTreatedLabelGroup)
{
   ?drug ?instance wd:Q12078.             #cancer drugs
   ?drug wdt:P117 ?molecularStructurePic.     #with chemical structure
   ?drug wdt:P592 ?ChemblKeyLabel.        #with chemble ID
   ?drug wdt:P129 ?physicalInteractionLabel. #receptor interaction
   ?physicalInteractionLabel rdfs:label ?physicalInteractionLabelGroup
             FILTER(LANGMATCHES(LANG(?physicalInteractionLabelGroup), "en"))                
   ?drug wdt:P3780 ?ActiveIn.             #is an active compound in a drug
   ?drug wdt:P2175 ?otherConditionsTreated. #other condtions
   ?otherConditionsTreated rdfs:label ?otherConditionsTreatedLabel
             FILTER(LANGMATCHES(LANG(?otherConditionsTreatedLabel), "en"))
   ?drug wdt:P2175 ?cancerTreated.        #what conditions are treated
   ?cancerTreated wdt:P1995 wd:Q162555.   #what specific cancers are treated (cancer has health speciality field oncology)
   ?cancerTreated rdfs:label ?cancerTreatedLabel
            FILTER(LANGMATCHES(LANG(?cancerTreatedLabel),"en"))
   ?ActiveIn rdfs:label ?ActiveInLabel
            FILTER(LANGMATCHES(LANG(?ActiveInLabel),"en"))
    
SERVICE wikibase:label { bd:serviceParam wikibase:language "[AUTO_LANGUAGE],en".}
   
}
GROUP BY ?drug ?drugLabel`;

const queryDispatcher = new SPARQLQueryDispatcher( endpointUrl );
queryDispatcher.query( sparqlQuery ).then( console.log );

        </script>
    </head>

    <body>
    
    </body>
</html>